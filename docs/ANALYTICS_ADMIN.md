# üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –∞–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–∏ Lumon Platform

> **–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 6 –Ω–æ—è–±—Ä—è 2025

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∞–¥–º–∏–Ω–æ–≤ –≤–∫–ª—é—á–∞–µ—Ç:
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–∏—Å—Ç–µ–º—ã
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∏ –∏—Ö –ª–∏–º–∏—Ç–∞–º–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

---

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞

### –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–õ–æ–≥–∏ –∏ –∞—É–¥–∏—Ç:**
- `audit_events` - —Å–æ–±—ã—Ç–∏—è –∞—É–¥–∏—Ç–∞ (–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, IP, user agent)

**–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏:**
- `user_limits` - –ª–∏–º–∏—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (generations_per_day, chats_per_month, etc.)
  - `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `limit_type` - —Ç–∏–ø –ª–∏–º–∏—Ç–∞
  - `limit_value` - –∑–Ω–∞—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞
  - `current_usage` - —Ç–µ–∫—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
  - `reset_at` - –≤—Ä–µ–º—è —Å–±—Ä–æ—Å–∞

**A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- `ab_experiments` - —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã (–Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, –ø—Ä–æ—Ü–µ–Ω—Ç —Ç—Ä–∞—Ñ–∏–∫–∞)
- `ab_assignments` - –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –≤–∞—Ä–∏–∞–Ω—Ç—ã (A/B)
- `ab_events` - —Å–æ–±—ã—Ç–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤ (–∫–æ–Ω–≤–µ—Ä—Å–∏–∏, –∫–ª–∏–∫–∏)

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:**
- `platform_stats` - –µ–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  - `date` - –¥–∞—Ç–∞
  - `total_users`, `active_users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
  - `total_companies`, `total_chats`, `total_messages` - –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
  - `new_users`, `new_companies` - –Ω–æ–≤—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥
  - `metrics` (JSONB) - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

### API Endpoints

**–õ–æ–≥–∏:**
- `GET /webhook/admin-logs-list` - —Å–ø–∏—Å–æ–∫ –ª–æ–≥–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
  - Query params: `limit`, `offset`, `action`, `user_id`

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:**
- `GET /webhook/admin-users-list` - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - Query params: `limit`, `offset`, `search`

**–õ–∏–º–∏—Ç—ã:**
- `GET /webhook/admin-user-limits-list` - —Å–ø–∏—Å–æ–∫ –ª–∏–º–∏—Ç–æ–≤
  - Query params: `user_id` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `POST /webhook/admin-user-limits-update` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞
  - Body: `user_id`, `limit_type`, `limit_value`, `reset_at`

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- `GET /webhook/admin-stats-platform` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

**A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- `GET /webhook/admin-ab-experiments-list` - —Å–ø–∏—Å–æ–∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
- `POST /webhook/admin-ab-experiment-create` - —Å–æ–∑–¥–∞–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞
  - Body: `name`, `description`, `feature_name`, `enabled`, `traffic_percentage`, `variant_a_config`, `variant_b_config`
- `POST /webhook/admin-ab-experiment-update` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞
  - Body: `id`, `enabled`, `traffic_percentage`, `variant_a_config`, `variant_b_config`

### Workflows

**Admin API workflows:**
- `admin.logs-list.json` - –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
- `admin.users-list.json` - —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `admin.stats-platform.json` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- `admin.user-limits-list.json` - —Å–ø–∏—Å–æ–∫ –ª–∏–º–∏—Ç–æ–≤
- `admin.user-limits-update.json` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞
- `admin.ab-experiments-list.json` - —Å–ø–∏—Å–æ–∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
- `admin.ab-experiment-create.json` - —Å–æ–∑–¥–∞–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞
- `admin.ab-experiment-update.json` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞

**Cron workflows:**
- `cron.aggregate-stats.json` - –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–∫–∞–∂–¥—ã–π —á–∞—Å)

### –¢–∞–±—ã –∞–¥–º–∏–Ω–∫–∏

**LogsTab.tsx:**
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–∏—Å—Ç–µ–º—ã
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–µ–π—Å—Ç–≤–∏—è–º
- –ü–æ–∏—Å–∫ –ø–æ –ª–æ–≥–∞–º
- –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è

**UsersTab.tsx:**
- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (—á–∞—Ç—ã, –∫–æ–º–ø–∞–Ω–∏–∏)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**AnalyticsTab.tsx:**
- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ–º–ø–∞–Ω–∏–π, —á–∞—Ç–æ–≤, —Å–æ–æ–±—â–µ–Ω–∏–π
- –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏

**ABTestingTab.tsx:**
- –°–ø–∏—Å–æ–∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
- –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º

---

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
curl -X GET "https://n8n.psayha.ru/webhook/admin-logs-list?limit=50&offset=0&action=chat.create" \
  -H "Authorization: Bearer <admin_token>"
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
curl -X POST "https://n8n.psayha.ru/webhook/admin-user-limits-update" \
  -H "Authorization: Bearer <admin_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "user_id": "uuid",
    "limit_type": "generations_per_day",
    "limit_value": 10
  }'
```

### –°–æ–∑–¥–∞–Ω–∏–µ A/B —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞

```bash
curl -X POST "https://n8n.psayha.ru/webhook/admin-ab-experiment-create" \
  -H "Authorization: Bearer <admin_token>" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "New UI Design",
    "feature_name": "ui_design",
    "enabled": true,
    "traffic_percentage": 50,
    "variant_a_config": {"theme": "light"},
    "variant_b_config": {"theme": "dark"}
  }'
```

---

## üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

Cron workflow `cron.aggregate-stats` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —á–∞—Å –∏:
- –°–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º, –∫–æ–º–ø–∞–Ω–∏—è–º, —á–∞—Ç–∞–º, —Å–æ–æ–±—â–µ–Ω–∏—è–º
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü—É `platform_stats`
- –û–±–Ω–æ–≤–ª—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–∞–ø–∏—Å–∏ –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å

---

## üéØ –¢–∏–ø—ã –ª–∏–º–∏—Ç–æ–≤

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã –ª–∏–º–∏—Ç–æ–≤:
- `generations_per_day` - –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ –¥–µ–Ω—å
- `chats_per_month` - —á–∞—Ç—ã –≤ –º–µ—Å—è—Ü
- `messages_per_day` - —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –¥–µ–Ω—å
- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–∏ —Ç–∏–ø—ã –ª–∏–º–∏—Ç–æ–≤

---

## üî¨ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞

1. **–°–æ–∑–¥–∞–Ω–∏–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è, —Ñ—É–Ω–∫—Ü–∏–∏, –ø—Ä–æ—Ü–µ–Ω—Ç–∞ —Ç—Ä–∞—Ñ–∏–∫–∞
2. **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –≤–∞—Ä–∏–∞–Ω—Ç—ã A/B
3. **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π** - –∑–∞–ø–∏—Å—å —Å–æ–±—ã—Ç–∏–π (view, click, conversion)
4. **–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** - —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –º–µ–∂–¥—É –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

```typescript
// –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const variant = await getABVariant(userId, 'ui_design');
if (variant === 'A') {
  // –í–∞—Ä–∏–∞–Ω—Ç A
} else {
  // –í–∞—Ä–∏–∞–Ω—Ç B
}

// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è
await trackABEvent(experimentId, userId, variant, 'click');
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 6 –Ω–æ—è–±—Ä—è 2025

