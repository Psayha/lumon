import { MigrationInterface, QueryRunner, Table } from 'typeorm';

export class CreateLegalDocsTable1764099155000 implements MigrationInterface {
  public async up(queryRunner: QueryRunner): Promise<void> {
    // Create legal_docs table
    await queryRunner.createTable(
      new Table({
        name: 'legal_docs',
        columns: [
          {
            name: 'id',
            type: 'uuid',
            isPrimary: true,
            generationStrategy: 'uuid',
            default: 'uuid_generate_v4()',
          },
          {
            name: 'title',
            type: 'varchar',
            length: '255',
          },
          {
            name: 'content',
            type: 'text',
          },
          {
            name: 'version',
            type: 'varchar',
            length: '50',
            default: "'1.0'",
          },
          {
            name: 'is_active',
            type: 'boolean',
            default: true,
          },
          {
            name: 'created_at',
            type: 'timestamptz',
            default: 'now()',
          },
          {
            name: 'updated_at',
            type: 'timestamptz',
            default: 'now()',
          },
        ],
      }),
      true,
    );

    // Insert initial legal documents
    await queryRunner.query(`
      INSERT INTO legal_docs (title, content, version, is_active) VALUES
      (
        'Пользовательское соглашение',
        'ПОЛЬЗОВАТЕЛЬСКОЕ СОГЛАШЕНИЕ

1. ОБЩИЕ ПОЛОЖЕНИЯ

1.1. Настоящее Пользовательское соглашение (далее — «Соглашение») регулирует отношения между владельцем сервиса Lumon (далее — «Сервис») и пользователем Сервиса.

1.2. Использование Сервиса означает безоговорочное согласие пользователя с настоящим Соглашением и указанными в нем условиями.

2. ПРЕДМЕТ СОГЛАШЕНИЯ

2.1. Сервис предоставляет пользователю доступ к автоматизированной системе управления бизнес-процессами через Telegram Mini App.

2.2. Все существующие на данный момент функции Сервиса, а также любое развитие их и/или добавление новых является предметом настоящего Соглашения.

3. ПРАВА И ОБЯЗАННОСТИ СТОРОН

3.1. Пользователь обязуется:
- Предоставлять достоверную информацию о себе
- Не использовать Сервис в противоправных целях
- Соблюдать условия настоящего Соглашения

3.2. Администрация Сервиса обязуется:
- Обеспечивать работоспособность Сервиса
- Защищать персональные данные пользователей
- Своевременно информировать об изменениях в Соглашении

4. ОТВЕТСТВЕННОСТЬ СТОРОН

4.1. Администрация не несет ответственности за:
- Временные сбои и перерывы в работе Сервиса
- Удаление или утрату данных пользователя
- Убытки, понесенные пользователем в связи с использованием Сервиса

5. ЗАКЛЮЧИТЕЛЬНЫЕ ПОЛОЖЕНИЯ

5.1. Настоящее Соглашение вступает в силу с момента регистрации пользователя в Сервисе.

5.2. Администрация оставляет за собой право в любое время изменять условия настоящего Соглашения.

По вопросам, связанным с настоящим Соглашением, вы можете обращаться по электронной почте: support@projectlumon.com',
        '1.0',
        true
      ),
      (
        'Политика конфиденциальности',
        'ПОЛИТИКА КОНФИДЕНЦИАЛЬНОСТИ

1. ОБЩИЕ ПОЛОЖЕНИЯ

1.1. Настоящая Политика конфиденциальности (далее — «Политика») определяет порядок обработки и защиты персональных данных пользователей Сервиса Lumon.

1.2. Используя Сервис, пользователь выражает свое согласие с условиями настоящей Политики.

2. СОБИРАЕМАЯ ИНФОРМАЦИЯ

2.1. Мы собираем следующую информацию:
- Telegram ID пользователя
- Имя и фамилия из профиля Telegram
- Username в Telegram
- Данные о взаимодействии с Сервисом

2.2. Информация собирается автоматически при использовании Telegram Mini App.

3. ИСПОЛЬЗОВАНИЕ ИНФОРМАЦИИ

3.1. Собранная информация используется для:
- Предоставления доступа к функциям Сервиса
- Улучшения качества Сервиса
- Связи с пользователем по вопросам работы Сервиса
- Анализа использования Сервиса

4. ЗАЩИТА ИНФОРМАЦИИ

4.1. Мы применяем технические и организационные меры для защиты персональных данных от несанкционированного доступа, изменения, раскрытия или уничтожения.

4.2. Доступ к персональным данным имеют только уполномоченные сотрудники.

5. ПЕРЕДАЧА ДАННЫХ ТРЕТЬИМ ЛИЦАМ

5.1. Мы не передаем персональные данные третьим лицам, за исключением случаев:
- Получения согласия пользователя
- Требования законодательства
- Необходимости для предоставления Сервиса (например, хостинг-провайдеры)

6. ПРАВА ПОЛЬЗОВАТЕЛЯ

6.1. Пользователь имеет право:
- Получать информацию о своих персональных данных
- Требовать исправления неточных данных
- Требовать удаления своих данных

7. ИЗМЕНЕНИЯ В ПОЛИТИКЕ

7.1. Мы оставляем за собой право вносить изменения в настоящую Политику. Об изменениях пользователи будут уведомлены через Сервис.

8. КОНТАКТНАЯ ИНФОРМАЦИЯ

8.1. По вопросам, связанным с обработкой персональных данных, вы можете обращаться по электронной почте: support@projectlumon.com',
        '1.0',
        true
      )
    `);
  }

  public async down(queryRunner: QueryRunner): Promise<void> {
    await queryRunner.dropTable('legal_docs');
  }
}
