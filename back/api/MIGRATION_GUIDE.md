# üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è —Å n8n –Ω–∞ NestJS API

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–í—Å—ë –≥–æ—Ç–æ–≤–æ –∫ –¥–µ–ø–ª–æ—é! –û–¥–∏–Ω —Å–∫—Ä–∏–ø—Ç —Å–¥–µ–ª–∞–µ—Ç –≤—Å—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

### üìã –®–∞–≥–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@cv5403621

# 2. –ü–µ—Ä–µ–π—Ç–∏ –≤ –ø—Ä–æ–µ–∫—Ç –∏ –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
cd /home/user/lumon
git pull origin claude/n8n-backend-discussion-01EyCeQ9q98KrPg4HanTuzyr

# 3. –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é API
cd back/api

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
sudo bash DEPLOY_TO_SERVER.sh
```

**–í–æ—Ç –∏ –≤—Å—ë!** –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –°–æ–±–µ—Ä–µ—Ç –ø—Ä–æ–µ–∫—Ç
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç –∏ –∑–∞–ø—É—Å—Ç–∏—Ç systemd —Å–µ—Ä–≤–∏—Å
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç nginx –∫–æ–Ω—Ñ–∏–≥
- ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç —Å—Ç–∞—Ä—ã–π n8n
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

```bash
# –°—Ç–∞—Ç—É—Å API
sudo systemctl status lumon-api

# –õ–æ–≥–∏ API
sudo journalctl -u lumon-api -f

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ API —Ä–∞–±–æ—Ç–∞–µ—Ç
curl http://localhost:3000/health
curl https://n8n.psayha.ru/health

# –õ–æ–≥–∏ nginx
sudo tail -f /var/log/nginx/lumon-api-access.log
```

---

## üîô –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–π n8n –æ–±—Ä–∞—Ç–Ω–æ
docker start lumon-n8n

# –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä—ã–π nginx –∫–æ–Ω—Ñ–∏–≥ (–±—É–¥–µ—Ç backup —Ñ–∞–π–ª)
sudo cp /etc/nginx/sites-available/n8n.psayha.ru.backup.* /etc/nginx/sites-available/n8n.psayha.ru
sudo systemctl reload nginx

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π API
sudo systemctl stop lumon-api
```

---

## üìä –ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—Å—è

**–î–æ –º–∏–≥—Ä–∞—Ü–∏–∏:**
- n8n.psayha.ru ‚Üí n8n (–ø–æ—Ä—Ç 5678)
- Workflow-based –±—ç–∫–µ–Ω–¥

**–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
- n8n.psayha.ru ‚Üí NestJS API (–ø–æ—Ä—Ç 3000)
- –ù–∞—Å—Ç–æ—è—â–∏–π TypeScript/NestJS –±—ç–∫–µ–Ω–¥
- –°—Ç–∞—Ä—ã–π n8n –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

---

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î:
```
Host: 127.0.0.1
Port: 5432
Database: lumon
User: postgres
Password: lumon_dev_password
```

### –ü–æ—Ä—Ç—ã:
- **3000** - NestJS API (–Ω–æ–≤—ã–π)
- **5678** - n8n (—Å—Ç–∞—Ä—ã–π, –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
- **5432** - PostgreSQL
- **3001** - Supabase Studio (sb.psayha.ru)

### –î–æ–º–µ–Ω—ã:
- **n8n.psayha.ru** - —Ç–µ–ø–µ—Ä—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ NestJS API
- **sb.psayha.ru** - Supabase Studio (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- **psayha.ru** - —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

---

## üöÄ –ì–æ—Ç–æ–≤–æ!
