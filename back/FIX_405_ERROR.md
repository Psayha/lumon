# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–∫–∏ 405 Not Allowed

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å POST –∑–∞–ø—Ä–æ—Å –∫ `/webhook/create-user` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞:
```
405 Not Allowed
nginx/1.24.0 (Ubuntu)
```

## üîç –ü—Ä–∏—á–∏–Ω–∞

–í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (`/etc/nginx/sites-available/lumon-frontend`) –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –±–ª–æ–∫ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è `/webhook/` –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ n8n —Å–µ—Ä–≤–µ—Ä—É.

–ë–µ–∑ —ç—Ç–æ–≥–æ –±–ª–æ–∫–∞ nginx –ø—ã—Ç–∞–µ—Ç—Å—è –Ω–∞–π—Ç–∏ —Ñ–∞–π–ª—ã –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–∞—Ö —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 405.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx

–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏:

```bash
# –ü–µ—Ä–µ–π–¥–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /root/lumon2

# –°–∫–æ–ø–∏—Ä—É–π –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo cp back/nginx-frontend.conf /etc/nginx/sites-available/lumon-frontend

# –ü—Ä–æ–≤–µ—Ä—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
sudo nginx -t

# –ï—Å–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ, –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏ nginx
sudo systemctl reload nginx
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –¢–µ—Å—Ç —Å —Å–µ—Ä–≤–µ—Ä–∞
curl -X POST https://psayha.ru/webhook/create-user \
  -H "Content-Type: application/json" \
  -d '{
    "telegram_id": 123456789,
    "username": "test_user",
    "first_name": "Test",
    "last_name": "User",
    "language_code": "ru",
    "is_premium": false
  }'
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∞ –Ω–µ 405 –æ—à–∏–±–∫–∞.

## üìù –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ nginx

–í –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–æ–±–∞–≤–ª–µ–Ω –±–ª–æ–∫:

```nginx
# Proxy –¥–ª—è n8n webhook endpoints
location /webhook/ {
    proxy_pass https://n8n.psayha.ru/webhook/;
    proxy_http_version 1.1;
    proxy_set_header Host n8n.psayha.ru;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    proxy_set_header X-Forwarded-Port $server_port;
    proxy_buffering off;
}
```

–≠—Ç–æ—Ç –±–ª–æ–∫:
- –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ `/webhook/*`
- –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –∏—Ö –Ω–∞ n8n —Å–µ—Ä–≤–µ—Ä `https://n8n.psayha.ru`
- –ü–µ—Ä–µ–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

## üéØ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

1. ‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ `/webhook/create-user`
2. ‚úÖ –ó–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç—Å—è –Ω–∞ n8n
3. ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. ‚úÖ –û—à–∏–±–∫–∞ 405 –∏—Å—á–µ–∑–ª–∞

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `back/nginx-frontend.conf` - –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx
- `back/CONNECT_FRONTEND.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- `src/config/api.ts` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API endpoints –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ

