# ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Nginx

## –ü—Ä–æ–±–ª–µ–º–∞

Nginx –∫–æ–Ω—Ñ–∏–≥–∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ (`n8n-simple`, `sb-simple`), —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–æ–º–µ–Ω–æ–≤.

## –†–µ—à–µ–Ω–∏–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –°–∫–æ–ø–∏—Ä—É–π —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä

–°–∫—Ä–∏–ø—Ç —É–∂–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏: `back/auto-fix-nginx.sh`

```bash
cd /var/www/back
chmod +x auto-fix-nginx.sh
```

### 2. –î–æ–±–∞–≤—å –≤ crontab

```bash
# –û—Ç–∫—Ä–æ–π crontab
sudo crontab -e

# –î–æ–±–∞–≤—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞:
*/5 * * * * /var/www/back/auto-fix-nginx.sh >> /var/log/nginx-autofix.log 2>&1

# –°–æ—Ö—Ä–∞–Ω–∏ –∏ –∑–∞–∫—Ä–æ–π (Ctrl+X, Y, Enter –≤ nano)
```

### 3. –ü—Ä–æ–≤–µ—Ä—å —Ä–∞–±–æ—Ç—É cron

```bash
# –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å cron
systemctl status cron

# –ü—Ä–æ–≤–µ—Ä—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
sudo crontab -l

# –ü—Ä–æ–≤–µ—Ä—å –ª–æ–≥ (—á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç)
tail -f /var/log/nginx-autofix.log
```

## –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

1. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –∫–æ–Ω—Ñ–∏–≥–æ–≤** (`n8n-simple`, `sb-simple`)
2. **–£–¥–∞–ª—è–µ—Ç –∏—Ö** –∏ —Å–æ–∑–¥–∞—ë—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–∏–º–ª–∏–Ω–∫–∏
3. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Å–∏–º–ª–∏–Ω–∫–æ–≤**
4. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å nginx** –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
5. **–õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è** –≤ `/var/log/nginx-autofix.log`

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏
tail -20 /var/log/nginx-autofix.log

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f /var/log/nginx-autofix.log
```

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç –≤—Ä—É—á–Ω—É—é
sudo bash /var/www/back/auto-fix-nginx.sh

# –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
bash /var/www/back/verify-nginx-configs.sh
```

## –û—Ç–∫–ª—é—á–µ–Ω–∏–µ

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:

```bash
# –û—Ç–∫—Ä–æ–π crontab
sudo crontab -e

# –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π —Å—Ç—Ä–æ–∫—É (–¥–æ–±–∞–≤—å # –≤ –Ω–∞—á–∞–ª–æ):
# */5 * * * * /var/www/back/auto-fix-nginx.sh >> /var/log/nginx-autofix.log 2>&1

# –ò–ª–∏ —É–¥–∞–ª–∏ –µ—ë –ø–æ–ª–Ω–æ—Å—Ç—å—é
```

## –ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: **–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç** (`*/5 * * * *`)

–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å:
- `*/1 * * * *` - –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (—á–∞—Å—Ç—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
- `*/10 * * * *` - –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
- `*/15 * * * *` - –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
- `0 * * * *` - –∫–∞–∂–¥—ã–π —á–∞—Å

## –õ–æ–≥–∏

–õ–æ–≥ —Ñ–∞–π–ª: `/var/log/nginx-autofix.log`

–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
```
[2025-11-06 21:50:00] üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π...
[2025-11-06 21:50:00] ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏! –ò—Å–ø—Ä–∞–≤–ª—è–µ–º...
[2025-11-06 21:50:01] ‚úÖ Nginx –∫–æ–Ω—Ñ–∏–≥–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–µ–Ω—ã
[2025-11-06 21:50:01] ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–î–æ–±–∞–≤—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤:

```bash
# –°–æ–∑–¥–∞–π –∞–ª–∏–∞—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
echo "alias check-nginx='tail -20 /var/log/nginx-autofix.log && bash /var/www/back/verify-nginx-configs.sh'" >> ~/.bashrc
source ~/.bashrc

# –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
check-nginx
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
ls -la /var/www/back/auto-fix-nginx.sh

# –°–¥–µ–ª–∞–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
sudo chmod +x /var/www/back/auto-fix-nginx.sh

# –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å cron
systemctl status cron

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ cron
sudo systemctl restart cron
```

### –ï—Å–ª–∏ –¥–æ–º–µ–Ω—ã –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç

```bash
# –†—É—á–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
cd /var/www/back
sudo bash auto-fix-nginx.sh

# –ï—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ, –ø–æ–ª–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
sudo rm /etc/nginx/sites-enabled/*
sudo ln -sf /etc/nginx/sites-available/lumon-frontend /etc/nginx/sites-enabled/lumon-frontend
sudo ln -sf /etc/nginx/sites-available/n8n.psayha.ru /etc/nginx/sites-enabled/n8n.psayha.ru
sudo ln -sf /etc/nginx/sites-available/sb.psayha.ru /etc/nginx/sites-enabled/sb.psayha.ru
sudo ln -sf /etc/nginx/sites-available/admin-panel /etc/nginx/sites-enabled/admin-panel
sudo nginx -t && sudo systemctl restart nginx
```

---

**–ì–æ—Ç–æ–≤–æ!** –¢–µ–ø–µ—Ä—å nginx –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç.

