import{j as e,m as S,A as W}from"./animations-d83e2c3f.js";import{a as ne,r as n,R as le}from"./react-vendor-b993c031.js";import{S as H,L as Q,A as R,X as V,I as de,a as X,C as Y,R as $,b as J,B,U as O,c as ce,d as oe,D as Z,H as z,e as xe,T as ee,f as me,g as he,M as ge,h as te,F as ue,i as ye,j as pe,k as be,P as fe,l as q,m as se,n as G,o as je,p as ae,q as ke,r as we,s as Ne,t as ve,u as Se}from"./icons-3dd327a3.js";(function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))f(a);new MutationObserver(a=>{for(const h of a)if(h.type==="childList")for(const d of h.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&f(d)}).observe(document,{childList:!0,subtree:!0});function u(a){const h={};return a.integrity&&(h.integrity=a.integrity),a.referrerPolicy&&(h.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?h.credentials="include":a.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function f(a){if(a.ep)return;a.ep=!0;const h=u(a);fetch(a.href,h)}})();var F={},K=ne;F.createRoot=K.createRoot,F.hydrateRoot=K.hydrateRoot;const _e=()=>({}).VITE_API_URL?{}.VITE_API_URL:"",_={baseUrl:_e(),endpoints:{adminLogin:"/webhook/admin/login",adminValidate:"/webhook/admin/validate",adminCompaniesList:"/webhook/admin/companies-list",adminLegalDocsList:"/webhook/admin/legal-docs-list",adminLegalDocsUpdate:"/webhook/admin/legal-docs-update",adminAiDocsList:"/webhook/admin/ai-docs-list",adminAiDocsDelete:"/webhook/admin/ai-docs-delete",backupList:"/webhook/admin/backup-list",backupCreate:"/webhook/admin/backup-create",backupRestore:"/webhook/admin/backup-restore",backupDelete:"/webhook/admin/backup-delete",healthCheckList:"/webhook/admin/health-check-list",healthCheck:"/webhook/admin/health-check",adminLogsList:"/webhook/admin/logs-list",adminUsersList:"/webhook/admin/users-list",adminUserLimitsList:"/webhook/admin/user-limits-list",adminUserLimitsUpdate:"/webhook/admin/user-limits-update",adminUserHistoryClear:"/webhook/admin/user-history-clear",adminUserDelete:"/webhook/admin/user-delete",adminStatsPlatform:"/webhook/admin/stats-platform",adminAbExperimentsList:"/webhook/admin/ab-experiments-list",adminAbExperimentCreate:"/webhook/admin/ab-experiment-create",adminAbExperimentUpdate:"/webhook/admin/ab-experiment-update"},timeout:3e4},re=s=>`${_.baseUrl}${s}`,Le=()=>{const s={"Content-Type":"application/json",Accept:"application/json"},y=localStorage.getItem("admin_token");return y&&(s.Authorization=`Bearer ${y}`),s},L=async(s,y={})=>{const u=s.startsWith("http")?s:re(s),f=Le();try{const a=await fetch(u,{...y,headers:{...f,...y.headers||{}}}),h=await a.text(),d=a.headers.get("content-type");let l;if(!h||h.trim()==="")return a.ok?{success:!0,data:void 0}:{success:!1,message:`Ошибка сервера: ${a.status} ${a.statusText||"Internal Server Error"}`};if(d&&d.includes("application/json"))try{l=JSON.parse(h)}catch{return{success:!1,message:`Ошибка сервера ${a.status}: Неверный формат ответа`}}else return a.ok?{success:!0,data:h}:{success:!1,message:`Ошибка сервера ${a.status}: ${h.substring(0,200)}`};if(!a.ok){const x=l;return{success:!1,message:x?.message||x?.error||`Ошибка сервера: ${a.status} ${a.statusText||"Internal Server Error"}`,data:x?.data}}return l}catch(a){return{success:!1,message:a instanceof Error?a.message:"Ошибка подключения к серверу"}}},Ce=({onLogin:s})=>{const[y,u]=n.useState(""),[f,a]=n.useState(""),[h,d]=n.useState(""),[l,x]=n.useState(!1),i=async m=>{m.preventDefault(),d(""),x(!0);try{const p=await fetch(re(_.endpoints.adminLogin),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:y,password:f})});if(p.ok){const j=await p.json();j.success&&j.data?.token?s(j.data.token):d("Неверный логин или пароль")}else{const j=await p.json().catch(()=>({}));d(j.message||"Неверный логин или пароль")}}catch{d("Ошибка подключения к серверу")}finally{x(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 dark:from-slate-900 dark:via-slate-800 dark:to-indigo-900 flex items-center justify-center p-4",children:e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-4",children:e.jsx(H,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Админ-панель"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Войдите для доступа к управлению"})]}),e.jsxs("form",{onSubmit:i,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Логин"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Q,{className:"w-5 h-5 text-gray-400"})}),e.jsx("input",{type:"text",value:y,onChange:m=>u(m.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Введите логин",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Пароль"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Q,{className:"w-5 h-5 text-gray-400"})}),e.jsx("input",{type:"password",value:f,onChange:m=>a(m.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Введите пароль",required:!0})]})]}),h&&e.jsxs(S.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-center space-x-2 text-sm text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 p-3 rounded-lg",children:[e.jsx(R,{className:"w-4 h-4"}),e.jsx("span",{children:h})]}),e.jsx("button",{type:"submit",disabled:l,className:"w-full py-2.5 px-4 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-medium rounded-lg hover:from-blue-600 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-all",children:l?"Вход...":"Войти"})]})]})})},ie=n.createContext(void 0),A=()=>{const s=n.useContext(ie);if(!s)throw new Error("useToast must be used within ToastProvider");return s},Te=({children:s})=>{const[y,u]=n.useState([]),f=n.useCallback((l,x,i=3e3)=>{const m=Math.random().toString(36).substr(2,9),p={id:m,type:l,message:x,duration:i};u(j=>[...j,p]),setTimeout(()=>{u(j=>j.filter(o=>o.id!==m))},i)},[]),a=n.useCallback(l=>{u(x=>x.filter(i=>i.id!==l))},[]),h=l=>{switch(l){case"success":return e.jsx(Y,{className:"w-5 h-5"});case"error":return e.jsx(X,{className:"w-5 h-5"});case"warning":return e.jsx(R,{className:"w-5 h-5"});case"info":return e.jsx(de,{className:"w-5 h-5"})}},d=l=>{switch(l){case"success":return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800 text-green-800 dark:text-green-200";case"error":return"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800 text-red-800 dark:text-red-200";case"warning":return"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800 text-yellow-800 dark:text-yellow-200";case"info":return"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800 text-blue-800 dark:text-blue-200"}};return e.jsxs(ie.Provider,{value:{showToast:f},children:[s,e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:e.jsx(W,{children:y.map(l=>e.jsxs(S.div,{initial:{opacity:0,x:300},animate:{opacity:1,x:0},exit:{opacity:0,x:300},className:`flex items-center space-x-3 px-4 py-3 rounded-lg border shadow-lg ${d(l.type)}`,children:[h(l.type),e.jsx("span",{className:"text-sm font-medium",children:l.message}),e.jsx("button",{onClick:()=>a(l.id),className:"ml-2 hover:opacity-70",children:e.jsx(V,{className:"w-4 h-4"})})]},l.id))})})]})},Ue=()=>{const[s,y]=n.useState([]),[u,f]=n.useState(""),[a,h]=n.useState(null),[d,l]=n.useState(!0),[x,i]=n.useState(null),{showToast:m}=A(),p=async()=>{l(!0),i(null);try{const c=await L(_.endpoints.adminCompaniesList);if(c.success&&c.data)y(c.data);else{const b=c.message||"Ошибка сервера: не удалось загрузить компании";i(b),m("error",b)}}catch(c){const b=c?.message||"Ошибка при загрузке компаний";i(b),m("error",b)}finally{l(!1)}};n.useEffect(()=>{p()},[]);const j=s.filter(c=>c.name.toLowerCase().includes(u.toLowerCase())),o=c=>{const b={owner:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400",manager:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",viewer:"bg-gray-100 text-gray-700 dark:bg-gray-700 dark:text-gray-300"};return b[c]||b.viewer};return d?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):x?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-6",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(R,{className:"w-6 h-6 text-red-600 dark:text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-900 dark:text-red-200 mb-2",children:"Ошибка загрузки данных"}),e.jsx("p",{className:"text-red-700 dark:text-red-300 mb-4",children:x}),e.jsxs("button",{onClick:p,className:"flex items-center space-x-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"Повторить попытку"})]})]})]})})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Компании"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Всего компаний: ",s.length]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(J,{className:"w-5 h-5 text-gray-400"})}),e.jsx("input",{type:"text",value:u,onChange:c=>f(c.target.value),placeholder:"Поиск по названию компании...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("div",{className:"space-y-4",children:j.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:u?"Компании не найдены":"Нет компаний"})]}):j.map(c=>e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors",onClick:()=>h(a===c.id?null:c.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(B,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white truncate",children:c.name}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1",children:[e.jsxs("div",{className:"flex items-center space-x-1 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("span",{children:[c.userCount," пользователей"]})]}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Создана: ",new Date(c.createdAt).toLocaleDateString("ru-RU")]})]})]})]}),a===c.id?e.jsx(ce,{className:"w-5 h-5 text-gray-400 flex-shrink-0"}):e.jsx(oe,{className:"w-5 h-5 text-gray-400 flex-shrink-0"})]})}),a===c.id&&e.jsx(S.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-slate-900/50",children:e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Пользователи:"}),c.users.map(b=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white dark:bg-slate-800 rounded-lg",children:[e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:b.username}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${o(b.role)}`,children:b.role})]},b.id))]})})]},c.id))})]})},Ee=()=>{const[s,y]=n.useState([]),[u,f]=n.useState(!0),[a,h]=n.useState(!1),{showToast:d}=A(),l=async()=>{f(!0);try{const o=await L(_.endpoints.backupList);if(o.success&&o.data)y(o.data);else{const c=o.message||"Не удалось загрузить бэкапы";d("error",c)}}catch(o){d("error",o?.message||"Ошибка при загрузке бэкапов")}finally{f(!1)}};n.useEffect(()=>{l()},[]);const x=async()=>{h(!0);try{const o=await L(_.endpoints.backupCreate,{method:"POST"});o.success?(await l(),d("success","Бэкап создан успешно")):d("error",`Ошибка: ${o.message||"Не удалось создать бэкап"}`)}catch{d("error","Ошибка при создании бэкапа")}finally{h(!1)}},i=async(o,c)=>{if(confirm("ВНИМАНИЕ: Это действие перезапишет текущую базу данных. Продолжить?"))try{const b=await L(_.endpoints.backupRestore,{method:"POST",body:JSON.stringify({backup_id:o,file_path:c})});b.success?d("success","Бэкап восстановлен успешно"):d("error",`Ошибка: ${b.message||"Не удалось восстановить бэкап"}`)}catch{d("error","Ошибка при восстановлении бэкапа")}},m=async o=>{if(confirm("Удалить этот бэкап?"))try{const c=await L(_.endpoints.backupDelete,{method:"POST",body:JSON.stringify({backup_id:o})});c.success?(await l(),d("success","Бэкап удален")):d("error",`Ошибка: ${c.message||"Не удалось удалить бэкап"}`)}catch{d("error","Ошибка при удалении бэкапа")}},p=o=>{if(o===0)return"0 B";const c=1024,b=["B","KB","MB","GB"],E=Math.floor(Math.log(o)/Math.log(c));return Math.round(o/Math.pow(c,E)*100)/100+" "+b[E]},j=o=>new Date(o).toLocaleString("ru-RU");return u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Бэкапы базы данных"}),e.jsx("button",{onClick:x,disabled:a,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:a?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 animate-spin"}),"Создание..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"w-4 h-4"}),"Создать бэкап"]})})]}),s.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(z,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Нет бэкапов"})]}):e.jsx("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Файл"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Размер"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Дата создания"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Статус"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Действия"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-slate-800 divide-y divide-gray-200 dark:divide-gray-700",children:s.map(o=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:o.filename}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:p(o.file_size)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-4 h-4"}),j(o.created_at)]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${o.status==="completed"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":o.status==="failed"?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400":"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"}`,children:o.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>i(o.id,o.file_path),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300",children:"Восстановить"}),e.jsx("button",{onClick:()=>m(o.id),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:e.jsx(ee,{className:"w-4 h-4"})})]})})]},o.id))})]})})]})},Me=()=>{const[s,y]=n.useState(null),[u,f]=n.useState([]),[a,h]=n.useState(!0),[d,l]=n.useState(!1),{showToast:x}=A(),i=async()=>{h(!0);try{const t=await L(_.endpoints.healthCheckList);t.success&&t.data?(t.data.system_status&&y(t.data.system_status),t.data.health_checks&&f(t.data.health_checks)):x("error",t.message||"Не удалось загрузить health checks")}catch{x("error","Ошибка при загрузке health checks")}finally{h(!1)}};n.useEffect(()=>{i()},[]);const m=async()=>{l(!0);try{const t=await L(_.endpoints.healthCheck,{method:"POST",body:JSON.stringify({service:"all"})});t.success?(await i(),x("success","Проверка завершена")):x("error",t.message||"Не удалось выполнить проверку")}catch{x("error","Ошибка при проверке здоровья системы")}finally{l(!1)}},p=async t=>{try{const g=await L(_.endpoints.healthCheck,{method:"POST",body:JSON.stringify({service:t})});g.success?(await i(),x("success",`Проверка ${t} завершена`)):x("error",g.message||"Не удалось выполнить проверку")}catch{x("error","Ошибка при проверке сервиса")}},o=(()=>{const t=u.filter(g=>g.service_name==="system"&&g.metrics).sort((g,v)=>new Date(g.checked_at).getTime()-new Date(v.checked_at).getTime()).slice(-20);return{cpu:t.map(g=>({value:g.metrics?.cpu_usage_percent||0,time:new Date(g.checked_at).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})})),memory:t.map(g=>({value:g.metrics?.memory_usage_percent||0,time:new Date(g.checked_at).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})})),disk:t.map(g=>({value:g.metrics?.disk_usage_percent||0,time:new Date(g.checked_at).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"})}))}})(),c=(t,g,v)=>{if(t.length===0)return null;const T=Math.max(...t.map(M=>M.value),100),C=100;return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(te,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:v})]}),e.jsxs("div",{className:"relative",style:{height:`${C}px`},children:[e.jsxs("svg",{width:"100%",height:C,className:"overflow-visible",children:[e.jsx("polyline",{points:t.map((M,I)=>{const D=I/(t.length-1||1)*100,r=C-M.value/T*C;return`${D}%,${r}`}).join(" "),fill:"none",stroke:g,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),t.map((M,I)=>{const D=I/(t.length-1||1)*100,r=C-M.value/T*C;return e.jsx("circle",{cx:`${D}%`,cy:r,r:"3",fill:g,className:"hover:r-4 transition-all"},I)})]}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[e.jsx("span",{children:t[0]?.time}),e.jsx("span",{children:t[t.length-1]?.time})]})]})]})},b=t=>{switch(t){case"healthy":return e.jsx(Y,{className:"w-5 h-5 text-green-500"});case"unhealthy":return e.jsx(X,{className:"w-5 h-5 text-red-500"});case"degraded":return e.jsx(R,{className:"w-5 h-5 text-yellow-500"});default:return e.jsx(R,{className:"w-5 h-5 text-gray-500"})}},E=t=>{switch(t){case"healthy":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"unhealthy":return"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400";case"degraded":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},P=["n8n","postgresql","nginx","supabase-studio"];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Health Checks"}),e.jsx("button",{onClick:m,disabled:d,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 flex items-center gap-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 animate-spin"}),"Проверка..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4"}),"Проверить все"]})})]}),s&&e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5"}),"Общий статус системы"]}),e.jsx("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${E(s.overall_status)}`,children:s.overall_status})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-4",children:["Последняя проверка: ",new Date(s.last_checked_at).toLocaleString("ru-RU")]}),s.system_metrics&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-slate-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(he,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"CPU"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[s.system_metrics.cpu_usage_percent.toFixed(1),"%"]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-slate-600 rounded-full h-2 mt-2",children:e.jsx("div",{className:`h-2 rounded-full ${s.system_metrics.cpu_usage_percent>80?"bg-red-500":s.system_metrics.cpu_usage_percent>60?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(s.system_metrics.cpu_usage_percent,100)}%`}})})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-slate-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ge,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Память"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[s.system_metrics.memory_usage_percent.toFixed(1),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[s.system_metrics.memory_used_mb," MB / ",s.system_metrics.memory_total_mb," MB"]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-slate-600 rounded-full h-2 mt-2",children:e.jsx("div",{className:`h-2 rounded-full ${s.system_metrics.memory_usage_percent>80?"bg-red-500":s.system_metrics.memory_usage_percent>60?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(s.system_metrics.memory_usage_percent,100)}%`}})})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-slate-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(z,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Диск"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[s.system_metrics.disk_usage_percent.toFixed(1),"%"]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[s.system_metrics.disk_used_gb," GB / ",s.system_metrics.disk_total_gb," GB"]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-slate-600 rounded-full h-2 mt-2",children:e.jsx("div",{className:`h-2 rounded-full ${s.system_metrics.disk_usage_percent>80?"bg-red-500":s.system_metrics.disk_usage_percent>60?"bg-yellow-500":"bg-green-500"}`,style:{width:`${Math.min(s.system_metrics.disk_usage_percent,100)}%`}})})]})]})]}),o.cpu.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"История метрик"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c(o.cpu,"#3b82f6","CPU"),c(o.memory,"#a855f7","Память"),c(o.disk,"#10b981","Диск")]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-6",children:P.map(t=>{const g=s?.services_status[t]||"unknown",v=u.filter(T=>T.service_name===t).sort((T,C)=>new Date(C.checked_at).getTime()-new Date(T.checked_at).getTime())[0];return e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white capitalize",children:t}),e.jsxs("div",{className:"flex items-center gap-2",children:[b(g),e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${E(g)}`,children:g})]})]}),v&&e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[v.response_time_ms&&e.jsxs("p",{children:["Время ответа: ",v.response_time_ms," мс"]}),v.error_message&&e.jsxs("p",{className:"text-red-600 dark:text-red-400",children:["Ошибка: ",v.error_message]}),e.jsxs("p",{className:"text-xs",children:["Проверено: ",new Date(v.checked_at).toLocaleString("ru-RU")]})]}),e.jsxs("button",{onClick:()=>p(t),className:"mt-4 w-full px-4 py-2 bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-slate-600 flex items-center justify-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),"Проверить"]})]},t)})})]})},$e=()=>{const[s,y]=n.useState([]),[u,f]=n.useState(!0),[a,h]=n.useState(""),[d,l]=n.useState(""),[x,i]=n.useState(1),[m,p]=n.useState(0),[j]=n.useState(50),{showToast:o}=A(),c=async()=>{f(!0);try{const t=new URLSearchParams({limit:j.toString(),offset:((x-1)*j).toString()});d&&t.append("action",d);const g=`${_.endpoints.adminLogsList}?${t}`,v=await L(g);if(v.success&&v.data)y(v.data),p(v.pagination?.total||0);else{const T=v.message||"Ошибка сервера: не удалось загрузить логи";o("error",T)}}catch(t){const g=t instanceof Error?t.message:"Ошибка при загрузке логов";o("error",g)}finally{f(!1)}};n.useEffect(()=>{c()},[x,d]);const b=s.filter(t=>{if(!a)return!0;const g=a.toLowerCase();return t.action.toLowerCase().includes(g)||t.user?.username?.toLowerCase().includes(g)||t.ip?.toLowerCase().includes(g)||JSON.stringify(t.metadata).toLowerCase().includes(g)}),E=Array.from(new Set(s.map(t=>t.action))),P=()=>{const t=[["ID","Action","Resource Type","User","IP","Created At"].join(","),...b.map(C=>[C.id,C.action,C.resourceType||"",C.user?.username||"System",C.ip||"",new Date(C.createdAt).toLocaleString("ru-RU")].join(","))].join(`
`),g=new Blob([t],{type:"text/csv"}),v=URL.createObjectURL(g),T=document.createElement("a");T.href=v,T.download=`logs-${new Date().toISOString().split("T")[0]}.csv`,T.click(),URL.revokeObjectURL(v),o("success","Логи экспортированы")};return u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Логи системы"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Всего записей: ",m]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:c,className:"flex items-center space-x-2 px-4 py-2 bg-gray-100 dark:bg-slate-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-slate-600 transition-colors",children:[e.jsx($,{className:"w-4 h-4"}),e.jsx("span",{children:"Обновить"})]}),e.jsxs("button",{onClick:P,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Экспорт CSV"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(J,{className:"w-5 h-5 text-gray-400"})}),e.jsx("input",{type:"text",value:a,onChange:t=>h(t.target.value),placeholder:"Поиск по логам...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsxs("select",{value:d,onChange:t=>{l(t.target.value),i(1)},className:"pl-10 pr-8 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Все действия"}),E.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-slate-900",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Время"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Действие"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Пользователь"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Ресурс"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"IP"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:b.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-gray-500 dark:text-gray-400",children:"Логи не найдены"})}):b.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-700",children:[e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-white",children:t.createdAt?new Date(t.createdAt).toLocaleString("ru-RU"):"-"}),e.jsx("td",{className:"px-4 py-3 text-sm",children:e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400",children:t.action})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-900 dark:text-white",children:t.user?`${t.user.username} (${t.user.firstName} ${t.user.lastName})`:"System"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400",children:t.resourceType?`${t.resourceType}:${t.resourceId?.substring(0,8)}`:"-"}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-500 dark:text-gray-400",children:t.ip||"-"})]},t.id))})]})}),m>j&&e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Показано ",(x-1)*j+1," - ",Math.min(x*j,m)," из ",m]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>i(t=>Math.max(1,t-1)),disabled:x===1,className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-700 text-gray-700 dark:text-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-slate-600",children:"Назад"}),e.jsxs("span",{className:"px-3 py-1 text-sm text-gray-700 dark:text-gray-300",children:["Страница ",x," из ",Math.ceil(m/j)]}),e.jsx("button",{onClick:()=>i(t=>Math.min(Math.ceil(m/j),t+1)),disabled:x>=Math.ceil(m/j),className:"px-3 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-700 text-gray-700 dark:text-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50 dark:hover:bg-slate-600",children:"Вперед"})]})]})]})]})},Ae=()=>{const[s,y]=n.useState([]),[u,f]=n.useState([]),[a,h]=n.useState(""),[d,l]=n.useState(null),[x,i]=n.useState(null),[m,p]=n.useState(0),[j,o]=n.useState(!0),[c,b]=n.useState(null),[E,P]=n.useState(100),{showToast:t}=A(),g=async()=>{o(!0);try{const r=new URLSearchParams;a&&r.append("search",a);const N=`${_.endpoints.adminUsersList}?${r}`,w=await L(N);if(w.success&&w.data)y(w.data);else{const k=w.message||"Ошибка сервера: не удалось загрузить пользователей";t("error",k)}}catch(r){const N=r instanceof Error?r.message:"Ошибка при загрузке пользователей";t("error",N)}finally{o(!1)}},v=async r=>{try{const N=new URLSearchParams;r&&N.append("user_id",r);const w=`${_.endpoints.adminUserLimitsList}?${N}`,k=await L(w);k.success&&k.data&&f(k.data)}catch{}};n.useEffect(()=>{g()},[]),n.useEffect(()=>{d&&v(d)},[d]);const T=async(r,N)=>{try{const w=await L(_.endpoints.adminUserLimitsUpdate,{method:"POST",body:JSON.stringify({user_id:r,limit_type:N,limit_value:m})});w.success?(t("success","Лимит обновлен"),await v(r),i(null)):t("error",w.message||"Не удалось обновить лимит")}catch{t("error","Ошибка при обновлении лимита")}},C=async(r,N)=>{if(confirm(`Очистить всю историю пользователя ${N}?`))try{const w=await L(_.endpoints.adminUserHistoryClear,{method:"POST",body:JSON.stringify({user_id:r})});w.success?(t("success","История очищена"),await g()):t("error",w.message||"Не удалось очистить историю")}catch{t("error","Ошибка при очистке истории")}},M=async(r,N)=>{if(confirm(`УДАЛИТЬ ПОЛЬЗОВАТЕЛЯ ${N} ПОЛНОСТЬЮ?

Будут удалены:
- Все чаты и сообщения
- Все лимиты
- Связи с компаниями
- Сам пользователь

Это действие необратимо!`))try{const w=await L(_.endpoints.adminUserDelete,{method:"POST",body:JSON.stringify({user_id:r})});w.success?(t("success","Пользователь удалён"),await g()):t("error",w.message||"Не удалось удалить пользователя")}catch{t("error","Ошибка при удалении пользователя")}},I=async(r,N)=>{try{const w=await L(_.endpoints.adminUserLimitsUpdate,{method:"POST",body:JSON.stringify({user_id:r,limit_type:"daily_requests",limit_value:N})});w.success?(t("success","Лимиты обновлены"),b(null),await g(),d&&await v(d)):t("error",w.message||"Не удалось обновить лимиты")}catch{t("error","Ошибка при обновлении лимитов")}},D=s.filter(r=>{if(!a)return!0;const N=a.toLowerCase();return r.username?.toLowerCase().includes(N)||r.firstName?.toLowerCase().includes(N)||r.lastName?.toLowerCase().includes(N)||r.telegramId.toString().includes(N)});return j?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Пользователи"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:["Всего пользователей: ",s.length]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(J,{className:"w-5 h-5 text-gray-400"})}),e.jsx("input",{type:"text",value:a,onChange:r=>h(r.target.value),placeholder:"Поиск по имени, username или Telegram ID...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsx("div",{className:"space-y-4",children:D.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(O,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:a?"Пользователи не найдены":"Нет пользователей"})]}):D.map(r=>{const N=u.filter(k=>k.userId===r.id),w=r.companies[0]?.role||"viewer";return e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors",onClick:()=>l(d===r.id?null:r.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-1",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(O,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[r.firstName," ",r.lastName," ",r.username&&`(@${r.username})`]}),e.jsxs("div",{className:"flex items-center space-x-4 mt-1 text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("span",{children:["TG ID: ",r.telegramId]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-semibold ${w==="owner"?"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-300":w==="manager"?"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300":"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-300"}`,children:w}),e.jsxs("span",{children:[r.chatsCount," чатов"]}),e.jsx("span",{children:r.companies.length>0?`${r.companies.length} компаний`:"Нет компании"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:k=>{k.stopPropagation(),b(r),P(N.find(U=>U.limitType==="daily_requests")?.limitValue||100)},className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:"Задать лимиты",children:e.jsx(ye,{className:"w-5 h-5"})}),e.jsx("button",{onClick:k=>{k.stopPropagation(),C(r.id,r.username||r.firstName||"пользователя")},className:"p-2 text-orange-600 hover:bg-orange-50 dark:hover:bg-orange-900/20 rounded-lg transition-colors",title:"Очистить историю",children:e.jsx($,{className:"w-5 h-5"})}),e.jsx("button",{onClick:k=>{k.stopPropagation(),M(r.id,r.username||r.firstName||"пользователя")},className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Удалить пользователя",children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsx(pe,{className:"w-5 h-5 text-gray-400"})]})]})}),d===r.id&&e.jsx(S.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-slate-900/50",children:e.jsxs("div",{className:"p-4 space-y-4",children:[r.companies.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Компании:"}),e.jsx("div",{className:"space-y-2",children:r.companies.map((k,U)=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white dark:bg-slate-800 rounded-lg",children:[e.jsxs("span",{className:"text-sm text-gray-900 dark:text-white",children:["ID: ",k.company_id]}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs font-semibold ${k.role==="owner"?"bg-purple-100 text-purple-800 dark:bg-purple-900/20 dark:text-purple-300":k.role==="manager"?"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-300":"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-300"}`,children:k.role})]},U))})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Лимиты:"}),e.jsx("div",{className:"space-y-2",children:N.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Нет установленных лимитов"}):N.map(k=>e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white dark:bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:k.limitType}),x===k.id?e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("input",{type:"number",value:m,onChange:U=>p(parseInt(U.target.value)||0),className:"w-24 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-slate-700 text-gray-900 dark:text-white"}),e.jsx("button",{onClick:U=>{U.stopPropagation(),T(r.id,k.limitType)},className:"p-1 text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20 rounded",children:e.jsx(be,{className:"w-4 h-4"})}),e.jsx("button",{onClick:U=>{U.stopPropagation(),i(null),p(0)},className:"p-1 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:e.jsx(V,{className:"w-4 h-4"})})]}):e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Использовано: ",k.currentUsage," / ",k.limitValue]})]}),x!==k.id&&e.jsx("button",{onClick:U=>{U.stopPropagation(),i(k.id),p(k.limitValue)},className:"p-1 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",children:e.jsx(fe,{className:"w-4 h-4"})})]},k.id))})]})]})})]},r.id)})}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",onClick:()=>b(null),children:e.jsxs(S.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white dark:bg-slate-800 rounded-xl shadow-2xl p-6 max-w-md w-full mx-4",onClick:r=>r.stopPropagation(),children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:"Управление лимитами"}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["Пользователь: ",c.firstName," ",c.lastName," (@",c.username,")"]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Дневной лимит запросов"}),e.jsx("input",{type:"number",value:E,onChange:r=>P(parseInt(r.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-slate-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",min:"0"}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Текущее использование: ",u.find(r=>r.userId===c.id&&r.limitType==="daily_requests")?.currentUsage||0," / ",u.find(r=>r.userId===c.id&&r.limitType==="daily_requests")?.limitValue||0]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>b(null),className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-slate-700 transition-colors",children:"Отмена"}),e.jsx("button",{onClick:()=>I(c.id,E),className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Сохранить"})]})]})})]})},Pe=()=>{const[s,y]=n.useState(null),[u,f]=n.useState(!0),{showToast:a}=A(),h=async()=>{f(!0);try{const l=await L(_.endpoints.adminStatsPlatform);if(l.success&&l.data)y(l.data);else{const x=l.message||"Ошибка сервера: не удалось загрузить статистику";a("error",x)}}catch(l){a("error",l?.message||"Ошибка при загрузке статистики")}finally{f(!1)}};if(n.useEffect(()=>{h()},[]),u)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})});if(!s)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Нет данных"})]});const d=[{title:"Всего пользователей",value:s.totalUsers,icon:O,color:"blue",change:s.newUsers30d,changeLabel:"новых за 30 дней"},{title:"Активных (30 дней)",value:s.activeUsers30d,icon:se,color:"green",change:s.activeUsers7d,changeLabel:"активных за 7 дней"},{title:"Всего компаний",value:s.totalCompanies,icon:B,color:"purple",change:s.newCompanies30d,changeLabel:"новых за 30 дней"},{title:"Всего чатов",value:s.totalChats,icon:G,color:"indigo"},{title:"Всего сообщений",value:s.totalMessages,icon:G,color:"pink"},{title:"Активных сессий",value:s.activeSessions,icon:te,color:"orange"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Аналитика платформы"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Статистика использования Lumon Platform"})]}),e.jsx("button",{onClick:h,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Обновить"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:d.map((l,x)=>{const i=l.icon,m={blue:"bg-blue-500",green:"bg-green-500",purple:"bg-purple-500",indigo:"bg-indigo-500",pink:"bg-pink-500",orange:"bg-orange-500"};return e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:x*.1},className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:`w-12 h-12 ${m[l.color]} rounded-lg flex items-center justify-center`,children:e.jsx(i,{className:"w-6 h-6 text-white"})})}),e.jsx("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2",children:l.title}),e.jsx("div",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:l.value.toLocaleString("ru-RU")}),l.change!==void 0&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[l.change>0&&"+",l.change," ",l.changeLabel]})]},x)})}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Графики использования"}),e.jsxs("div",{className:"text-center py-12 text-gray-500 dark:text-gray-400",children:[e.jsx(q,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Графики будут добавлены в следующей версии"})]})]})]})},Ie=()=>{const[s,y]=n.useState([]),[u,f]=n.useState(!0),[a,h]=n.useState(!1);n.useState(null);const{showToast:d}=A(),l=async()=>{f(!0);try{const i=await L(_.endpoints.adminAbExperimentsList);if(i.success&&i.data)y(i.data);else{const m=i.message||"Ошибка сервера: не удалось загрузить эксперименты";d("error",m)}}catch(i){const m=i instanceof Error?i.message:"Ошибка при загрузке экспериментов";d("error",m)}finally{f(!1)}};n.useEffect(()=>{l()},[]);const x=async(i,m)=>{try{const p=await L(_.endpoints.adminAbExperimentUpdate,{method:"POST",body:JSON.stringify({id:i,enabled:!m})});p.success?(d("success",m?"Эксперимент отключен":"Эксперимент включен"),await l()):d("error",p.message||"Не удалось обновить эксперимент")}catch{d("error","Ошибка при обновлении эксперимента")}};return u?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"A/B Тестирование"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Управление экспериментами"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{children:"Создать эксперимент"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.length===0?e.jsxs("div",{className:"col-span-2 text-center py-12",children:[e.jsx(ae,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Нет экспериментов"})]}):s.map(i=>e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:i.name}),i.description&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:i.description})]}),e.jsx("button",{onClick:()=>x(i.id,i.enabled),className:"ml-2",children:i.enabled?e.jsx(ke,{className:"w-6 h-6 text-green-500"}):e.jsx(we,{className:"w-6 h-6 text-gray-400"})})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Функция:"}),e.jsx("span",{className:"text-gray-900 dark:text-white font-medium",children:i.featureName})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Трафик:"}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[i.trafficPercentage,"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Вариант A:"}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[i.variantAUsers," пользователей"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Вариант B:"}),e.jsxs("span",{className:"text-gray-900 dark:text-white font-medium",children:[i.variantBUsers," пользователей"]})]})]})]},i.id))})]})},De=()=>{const[s,y]=n.useState(!1),[u,f]=n.useState("companies"),[a,h]=n.useState(!0);n.useEffect(()=>{localStorage.getItem("admin_token")&&y(!0)},[]);const d=i=>{localStorage.setItem("admin_token",i),y(!0)},l=()=>{localStorage.removeItem("admin_token"),y(!1)};if(n.useEffect(()=>{(()=>{window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")})();const m=window.matchMedia("(prefers-color-scheme: dark)"),p=j=>{j.matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};return m.addEventListener?(m.addEventListener("change",p),()=>{m.removeEventListener("change",p)}):(m.addListener(p),()=>{m.removeListener(p)})},[]),n.useEffect(()=>(document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",()=>{document.body.style.overflow="",document.documentElement.style.overflow=""}),[]),!s)return e.jsx(Ce,{onLogin:d});const x=[{id:"companies",label:"Компании",icon:B},{id:"backups",label:"Бэкапы",icon:z},{id:"health",label:"Health Checks",icon:se},{id:"logs",label:"Логи",icon:Se},{id:"users",label:"Пользователи",icon:O},{id:"analytics",label:"Аналитика",icon:q},{id:"ab-testing",label:"A/B Тесты",icon:ae}];return e.jsx(Te,{children:e.jsxs("div",{className:"min-h-screen bg-white dark:bg-slate-950 fixed inset-0 overflow-hidden flex",children:[e.jsxs(S.aside,{initial:!1,animate:{width:a?"256px":"64px"},className:"bg-white dark:bg-slate-900 border-r border-gray-200 dark:border-slate-800 flex flex-col h-full transition-all duration-200",children:[e.jsxs("div",{className:"h-16 border-b border-gray-200 dark:border-slate-800 flex items-center justify-between px-4",children:[a&&e.jsxs(S.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-slate-900 dark:bg-white rounded-lg flex items-center justify-center",children:e.jsx(H,{className:"w-5 h-5 text-white dark:text-slate-900"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:"Админ-панель"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Lumon"})]})]}),!a&&e.jsx("div",{className:"w-8 h-8 bg-slate-900 dark:bg-white rounded-lg flex items-center justify-center mx-auto",children:e.jsx(H,{className:"w-5 h-5 text-white dark:text-slate-900"})}),e.jsx("button",{onClick:()=>h(!a),className:"p-1.5 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 text-gray-600 dark:text-gray-400 transition-colors",children:a?e.jsx(V,{className:"w-4 h-4"}):e.jsx(Ne,{className:"w-4 h-4"})})]}),e.jsx("nav",{className:"flex-1 overflow-y-auto py-4 px-2 scrollbar-thin",children:x.map(i=>{const m=i.icon,p=u===i.id;return e.jsxs(S.button,{onClick:()=>f(i.id),className:`
                    w-full flex items-center space-x-3 px-3 py-2.5 rounded-lg mb-1 transition-all duration-150
                    ${p?"bg-slate-100 dark:bg-slate-800 text-slate-900 dark:text-white":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-slate-800/50 hover:text-gray-900 dark:hover:text-white"}
                  `,whileHover:{x:2},whileTap:{scale:.98},children:[e.jsx(m,{className:`w-5 h-5 flex-shrink-0 ${p?"text-slate-900 dark:text-white":""}`}),a&&e.jsx(S.span,{initial:{opacity:0},animate:{opacity:1},className:"text-sm font-medium whitespace-nowrap",children:i.label})]},i.id)})}),e.jsx("div",{className:"border-t border-gray-200 dark:border-slate-800 p-4",children:e.jsxs(S.button,{onClick:l,className:"w-full flex items-center space-x-3 px-3 py-2.5 rounded-lg text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-slate-800/50 hover:text-gray-900 dark:hover:text-white transition-all duration-150",whileHover:{x:2},whileTap:{scale:.98},children:[e.jsx(ve,{className:"w-5 h-5 flex-shrink-0"}),a&&e.jsx(S.span,{initial:{opacity:0},animate:{opacity:1},className:"text-sm font-medium",children:"Выйти"})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("div",{className:"h-16 border-b border-gray-200 dark:border-slate-800 bg-white dark:bg-slate-900 flex items-center px-6",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:x.find(i=>i.id===u)?.label})}),e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50 dark:bg-slate-950 scrollbar-thin",children:e.jsx("div",{className:"p-6",children:e.jsxs(W,{mode:"wait",children:[u==="companies"&&e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Ue,{})},"companies"),u==="backups"&&e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Ee,{})},"backups"),u==="health"&&e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Me,{})},"health"),u==="logs"&&e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx($e,{})},"logs"),u==="users"&&e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Ae,{})},"users"),u==="analytics"&&e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Pe,{})},"analytics"),u==="ab-testing"&&e.jsx(S.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:e.jsx(Ie,{})},"ab-testing")]})})})]})]})})};const Re=()=>{window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};Re();F.createRoot(document.getElementById("root")).render(e.jsx(le.StrictMode,{children:e.jsx(De,{})}));
