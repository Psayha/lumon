---
globs: front/**/*.tsx,packages/**/*.tsx
description: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Telegram Mini Apps —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π Lumon
---

# ü§ñ Telegram Integration Rules

## üéØ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π Lumon

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ TMA –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```
front/tma/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/           # –°—Ç—Ä–∞–Ω–∏—Ü—ã Mini App
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MenuPage.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProfilePage.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SettingsPage.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ components/      # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã TMA
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ TelegramButton.tsx
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ TelegramCard.tsx
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ TelegramLayout.tsx
‚îÇ   ‚îú‚îÄ‚îÄ hooks/              # Telegram —Ö—É–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useTelegram.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useTelegramTheme.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useTelegramUser.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useTelegramStorage.ts
‚îÇ   ‚îú‚îÄ‚îÄ utils/              # Telegram —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegramApi.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ telegramAuth.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ telegramStorage.ts
‚îÇ   ‚îî‚îÄ‚îÄ types/              # Telegram —Ç–∏–ø—ã
‚îÇ       ‚îú‚îÄ‚îÄ telegram.ts
‚îÇ       ‚îî‚îÄ‚îÄ webapp.ts
```

> **üéØ –í–ê–ñ–ù–û:** –í—Å–µ –æ–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `packages/`, –∞ –Ω–µ –≤ `front/shared/`!

## üé® Telegram-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Telegram Layout –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - Telegram Layout —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç–µ–º
import React from 'react';
import { useTelegramTheme } from '../hooks/useTelegramTheme';
import { useTelegram } from '../hooks/useTelegram';

interface TelegramLayoutProps {
  children: React.ReactNode;
  showBackButton?: boolean;
  showMainButton?: boolean;
  mainButtonText?: string;
  onMainButtonClick?: () => void;
  onBackButtonClick?: () => void;
}

export const TelegramLayout: React.FC<TelegramLayoutProps> = ({
  children,
  showBackButton = false,
  showMainButton = false,
  mainButtonText = '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å',
  onMainButtonClick,
  onBackButtonClick
}) => {
  const { tg, isReady } = useTelegram();
  const { themeParams, colorScheme } = useTelegramTheme();

  React.useEffect(() => {
    if (!isReady || !tg) return;

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
    if (showBackButton) {
      tg.BackButton.show();
      tg.BackButton.onClick(onBackButtonClick || (() => tg.close()));
    } else {
      tg.BackButton.hide();
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
    if (showMainButton) {
      tg.MainButton.setText(mainButtonText);
      tg.MainButton.show();
      tg.MainButton.onClick(onMainButtonClick || (() => {}));
    } else {
      tg.MainButton.hide();
    }

    // –û—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
    return () => {
      tg.BackButton.hide();
      tg.MainButton.hide();
    };
  }, [tg, isReady, showBackButton, showMainButton, mainButtonText, onMainButtonClick, onBackButtonClick]);

  return (
    <div 
      className="min-h-screen"
      style={{
        backgroundColor: themeParams.bg_color || '#ffffff',
        color: themeParams.text_color || '#000000'
      }}
    >
      {children}
    </div>
  );
};
```

### Telegram Button –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - Telegram Button —Å –Ω–∞—Ç–∏–≤–Ω—ã–º —Å—Ç–∏–ª–µ–º
import React from 'react';
import { useTelegramTheme } from '../hooks/useTelegramTheme';

interface TelegramButtonProps {
  children: React.ReactNode;
  onClick?: () => void;
  variant?: 'primary' | 'secondary';
  disabled?: boolean;
  className?: string;
}

export const TelegramButton: React.FC<TelegramButtonProps> = ({
  children,
  onClick,
  variant = 'primary',
  disabled = false,
  className = ''
}) => {
  const { themeParams } = useTelegramTheme();

  const getButtonStyle = () => {
    if (variant === 'primary') {
      return {
        backgroundColor: themeParams.button_color || '#2481cc',
        color: themeParams.button_text_color || '#ffffff'
      };
    } else {
      return {
        backgroundColor: themeParams.secondary_bg_color || '#f1f1f1',
        color: themeParams.text_color || '#000000',
        border: `1px solid ${themeParams.hint_color || '#999999'}`
      };
    }
  };

  return (
    <button
      onClick={onClick}
      disabled={disabled}
      className={`
        px-4 py-2 rounded-lg font-medium
        transition-opacity duration-150
        disabled:opacity-50 disabled:cursor-not-allowed
        ${className}
      `}
      style={getButtonStyle()}
    >
      {children}
    </button>
  );
};
```

### Telegram Card –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - Telegram Card —Å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º —Å—Ç–∏–ª–µ–º
import React from 'react';
import { useTelegramTheme } from '../hooks/useTelegramTheme';

interface TelegramCardProps {
  children: React.ReactNode;
  className?: string;
  onClick?: () => void;
}

export const TelegramCard: React.FC<TelegramCardProps> = ({
  children,
  className = '',
  onClick
}) => {
  const { themeParams } = useTelegramTheme();

  return (
    <div
      onClick={onClick}
      className={`
        p-4 rounded-lg shadow-sm
        transition-colors duration-150
        ${onClick ? 'cursor-pointer hover:opacity-90' : ''}
        ${className}
      `}
      style={{
        backgroundColor: themeParams.secondary_bg_color || '#f8f9fa',
        border: `1px solid ${themeParams.hint_color || '#e5e5e5'}`
      }}
    >
      {children}
    </div>
  );
};
```

## üîß Telegram —Ö—É–∫–∏

### useTelegram —Ö—É–∫
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –ø—Ä–æ—Å—Ç–æ–π —Ö—É–∫ –¥–ª—è Telegram WebApp
import { useState, useEffect } from 'react';

interface TelegramWebApp {
  ready: () => void;
  expand: () => void;
  close: () => void;
  BackButton: {
    show: () => void;
    hide: () => void;
    onClick: (callback: () => void) => void;
  };
  MainButton: {
    show: () => void;
    hide: () => void;
    setText: (text: string) => void;
    onClick: (callback: () => void) => void;
  };
  HapticFeedback: {
    impactOccurred: (style: 'light' | 'medium' | 'heavy') => void;
  };
}

export const useTelegram = () => {
  const [tg, setTg] = useState<TelegramWebApp | null>(null);
  const [isReady, setIsReady] = useState(false);

  useEffect(() => {
    const telegramWebApp = (window as any).Telegram?.WebApp;
    
    if (telegramWebApp) {
      setTg(telegramWebApp);
      telegramWebApp.ready();
      setIsReady(true);
    }
  }, []);

  return { tg, isReady };
};
```

### useTelegramTheme —Ö—É–∫
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Ö—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–º–∞–º–∏ Telegram
import { useState, useEffect } from 'react';

interface TelegramThemeParams {
  bg_color?: string;
  text_color?: string;
  hint_color?: string;
  link_color?: string;
  button_color?: string;
  button_text_color?: string;
  secondary_bg_color?: string;
}

export const useTelegramTheme = () => {
  const [themeParams, setThemeParams] = useState<TelegramThemeParams>({});
  const [colorScheme, setColorScheme] = useState<'light' | 'dark'>('light');

  useEffect(() => {
    const tg = (window as any).Telegram?.WebApp;
    
    if (tg) {
      const params = tg.initDataUnsafe?.theme_params || {};
      setThemeParams(params);
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É
      const isDark = tg.colorScheme === 'dark';
      setColorScheme(isDark ? 'dark' : 'light');
    }
  }, []);

  return { themeParams, colorScheme };
};
```

### useTelegramUser —Ö—É–∫
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Ö—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º Telegram
import { useState, useEffect } from 'react';

interface TelegramUser {
  id: number;
  first_name: string;
  last_name?: string;
  username?: string;
  language_code?: string;
  is_premium?: boolean;
}

export const useTelegramUser = () => {
  const [user, setUser] = useState<TelegramUser | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const tg = (window as any).Telegram?.WebApp;
    
    if (tg) {
      const userData = tg.initDataUnsafe?.user;
      setUser(userData || null);
      setIsLoading(false);
    }
  }, []);

  return { user, isLoading };
};
```

## üìù –ü–†–ò–ú–ï–†–´ –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø

### Telegram-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å Telegram Layout
import React from 'react';
import { TelegramLayout } from '../components/TelegramLayout';
import { TelegramCard } from '../components/TelegramCard';
import { TelegramButton } from '../components/TelegramButton';
import { useTelegramUser } from '../hooks/useTelegramUser';

const MenuPage: React.FC = () => {
  const { user } = useTelegramUser();
  
  const handleMainButtonClick = () => {
    // –õ–æ–≥–∏–∫–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏
    console.log('Main button clicked');
  };
  
  const handleBackButtonClick = () => {
    // –õ–æ–≥–∏–∫–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"
    console.log('Back button clicked');
  };
  
  return (
    <TelegramLayout
      showBackButton={true}
      showMainButton={true}
      mainButtonText="–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
      onMainButtonClick={handleMainButtonClick}
      onBackButtonClick={handleBackButtonClick}
    >
      <div className="p-4 space-y-4">
        <h1 className="text-2xl font-bold">
          –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {user?.first_name}!
        </h1>
        
        <TelegramCard className="p-4">
          <h2 className="text-lg font-semibold mb-2">–ú–µ–Ω—é</h2>
          <p className="text-sm opacity-75">
            –í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ –∏–∑ –º–µ–Ω—é –Ω–∏–∂–µ
          </p>
        </TelegramCard>
        
        <div className="space-y-2">
          <TelegramButton 
            variant="primary" 
            className="w-full"
            onClick={() => console.log('Profile clicked')}
          >
            –ü—Ä–æ—Ñ–∏–ª—å
          </TelegramButton>
          
          <TelegramButton 
            variant="secondary" 
            className="w-full"
            onClick={() => console.log('Settings clicked')}
          >
            –ù–∞—Å—Ç—Ä–æ–π–∫–∏
          </TelegramButton>
        </div>
      </div>
    </TelegramLayout>
  );
};

export default MenuPage;
```

## üéØ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Telegram WebApp**
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
const MyComponent = () => {
  const { tg, isReady } = useTelegram();
  
  if (!isReady) {
    return <LoadingSpinner />;
  }
  
  return <div>–ö–æ–Ω—Ç–µ–Ω—Ç</div>;
};
```

### 2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Telegram-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
<TelegramLayout showMainButton={true}>
  <TelegramCard>
    <TelegramButton variant="primary">
      –ö–Ω–æ–ø–∫–∞
    </TelegramButton>
  </TelegramCard>
</TelegramLayout>
```

### 3. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å Lumon –ø–∞–∫–µ—Ç–∞–º–∏**
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
import { Card, Button } from '@lumon/ui';
import { User } from '@lumon/types';
import { apiClient } from '@lumon/api';
import { useTelegram } from '../hooks/useTelegram';
```

### 4. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏ Telegram API**
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
const handleTelegramAction = () => {
  try {
    const tg = (window as any).Telegram?.WebApp;
    if (tg) {
      tg.HapticFeedback.impactOccurred('medium');
      // –î–µ–π—Å—Ç–≤–∏–µ
    }
  } catch (error) {
    console.error('Telegram API error:', error);
  }
};
```

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û

### ‚ùå –ù–ï –î–ï–õ–ê–ô–¢–ï
```tsx
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - —Å–ª–æ–∂–Ω—ã–µ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
const ComplexTelegramWrapper = () => {
  // –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ª–æ–≥–∏–∫–∏
};

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–º
const BadComponent = () => {
  return <div style={{ backgroundColor: 'white' }}>Content</div>;
};

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫
const UnsafeComponent = () => {
  const tg = window.Telegram.WebApp; // –ú–æ–∂–µ—Ç –±—ã—Ç—å undefined
  return <div>{tg.initData}</div>;
};
```

### ‚úÖ –î–ï–õ–ê–ô–¢–ï –¢–ê–ö
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –ø—Ä–æ—Å—Ç—ã–µ —Ö—É–∫–∏
const useTelegram = () => {
  const tg = window.Telegram?.WebApp;
  return { tg, isReady: !!tg };
};

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–µ–º—ã
const GoodComponent = () => {
  const { themeParams } = useTelegramTheme();
  return (
    <div style={{ backgroundColor: themeParams.bg_color }}>
      Content
    </div>
  );
};

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
const SafeComponent = () => {
  const { tg, isReady } = useTelegram();
  if (!isReady) return <LoadingSpinner />;
  return <div>{tg.initData}</div>;
};
```

---

**–ü–æ–º–Ω–∏**: Telegram WebApp - —ç—Ç–æ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è —Å—Ä–µ–¥–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏ –∞–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ—Å—å –∫ —Ç–µ–º–∞–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.