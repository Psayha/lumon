---
globs: front/**/*.tsx,packages/**/*.tsx
description: React 18 –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è Lumon
---

# ‚öõÔ∏è React 18 Patterns

## üéØ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã React 18

### ‚úÖ –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å —Ö—É–∫–∞–º–∏
- –ò–∑–±–µ–≥–∞–π—Ç–µ –∫–ª–∞—Å—Å–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ TypeScript –¥–ª—è —Å—Ç—Ä–æ–≥–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
- –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ö—É–∫–∏ (useState, useEffect, useCallback, useMemo)

### ‚úÖ CONCURRENT FEATURES
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `startTransition` –¥–ª—è –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ `useDeferredValue` –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `useId` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ID
- –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ `useSyncExternalStore` –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### ‚úÖ SUSPENSE –ò LAZY LOADING
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `React.lazy` –¥–ª—è –ª–µ–Ω–∏–≤–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –ü—Ä–∏–º–µ–Ω—è–π—Ç–µ `Suspense` —Å fallback –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ErrorBoundary` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

## üìù –ü–†–ò–ú–ï–†–´ –°–û–í–†–ï–ú–ï–ù–ù–´–• –ü–ê–¢–¢–ï–†–ù–û–í

### ‚úÖ Concurrent Features
```tsx
import React, { useState, useTransition, useDeferredValue, useId } from 'react';

const SearchComponent: React.FC = () => {
  const [query, setQuery] = useState('');
  const [isPending, startTransition] = useTransition();
  const deferredQuery = useDeferredValue(query);
  const searchId = useId();

  const handleSearch = (value: string) => {
    startTransition(() => {
      setQuery(value);
    });
  };

  return (
    <div>
      <input
        id={searchId}
        type="text"
        placeholder="–ü–æ–∏—Å–∫..."
        onChange={(e) => handleSearch(e.target.value)}
        className="w-full p-3 border rounded-lg"
      />
      {isPending && (
        <div className="flex items-center justify-center p-4">
          <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
        </div>
      )}
      <SearchResults query={deferredQuery} />
    </div>
  );
};

const SearchResults: React.FC<{ query: string }> = ({ query }) => {
  const [results, setResults] = useState([]);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (!query) {
      setResults([]);
      return;
    }

    setLoading(true);
    const searchTimeout = setTimeout(async () => {
      try {
        const response = await fetch(`/api/search?q=${query}`);
        const data = await response.json();
        setResults(data.results);
      } catch (error) {
        console.error('Search error:', error);
      } finally {
        setLoading(false);
      }
    }, 300);

    return () => clearTimeout(searchTimeout);
  }, [query]);

  if (loading) {
    return <div className="p-4 text-center">–ó–∞–≥—Ä—É–∑–∫–∞...</div>;
  }

  return (
    <div className="mt-4 space-y-2">
      {results.map((result: any) => (
        <div key={result.id} className="p-3 bg-gray-50 rounded-lg">
          <h3 className="font-semibold">{result.title}</h3>
          <p className="text-gray-600">{result.description}</p>
        </div>
      ))}
    </div>
  );
};
```

### ‚úÖ Suspense –∏ Lazy Loading
```tsx
import React, { Suspense, lazy, ErrorBoundary } from 'react';

// Lazy loading —Ç—è–∂–µ–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
const HeavyChart = lazy(() => import('./HeavyChart'));
const DataTable = lazy(() => import('./DataTable'));
const ReportGenerator = lazy(() => import('./ReportGenerator'));

// Error Boundary –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
class ErrorBoundary extends React.Component<
  { children: React.ReactNode },
  { hasError: boolean; error?: Error }
> {
  constructor(props: { children: React.ReactNode }) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error: Error) {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('Error caught by boundary:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return (
        <div className="p-6 bg-red-50 border border-red-200 rounded-lg">
          <h2 className="text-lg font-semibold text-red-800 mb-2">
            –ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫
          </h2>
          <p className="text-red-600">
            –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.
          </p>
          <button
            onClick={() => this.setState({ hasError: false })}
            className="mt-4 px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
          >
            –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
          </button>
        </div>
      );
    }

    return this.props.children;
  }
}

// Fallback –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è Suspense
const LoadingFallback: React.FC = () => (
  <div className="flex items-center justify-center h-64">
    <div className="text-center">
      <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
      <p className="text-gray-600">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞...</p>
    </div>
  </div>
);

const Dashboard: React.FC = () => {
  const [activeTab, setActiveTab] = useState('chart');

  const renderTabContent = () => {
    switch (activeTab) {
      case 'chart':
        return (
          <ErrorBoundary>
            <Suspense fallback={<LoadingFallback />}>
              <HeavyChart />
            </Suspense>
          </ErrorBoundary>
        );
      case 'table':
        return (
          <ErrorBoundary>
            <Suspense fallback={<LoadingFallback />}>
              <DataTable />
            </Suspense>
          </ErrorBoundary>
        );
      case 'report':
        return (
          <ErrorBoundary>
            <Suspense fallback={<LoadingFallback />}>
              <ReportGenerator />
            </Suspense>
          </ErrorBoundary>
        );
      default:
        return null;
    }
  };

  return (
    <div className="p-6">
      <div className="flex space-x-4 mb-6">
        {['chart', 'table', 'report'].map(tab => (
          <button
            key={tab}
            onClick={() => setActiveTab(tab)}
            className={`px-4 py-2 rounded transition-colors ${
              activeTab === tab 
                ? 'bg-blue-500 text-white' 
                : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
            }`}
          >
            {tab.charAt(0).toUpperCase() + tab.slice(1)}
          </button>
        ))}
      </div>
      
      {renderTabContent()}
    </div>
  );
};

export default Dashboard;
```

### ‚úÖ Custom Hooks —Å TypeScript
```tsx
import { useState, useEffect, useCallback, useRef } from 'react';

// –•—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å API
interface UseApiOptions<T> {
  initialData?: T;
  onSuccess?: (data: T) => void;
  onError?: (error: Error) => void;
}

interface UseApiReturn<T> {
  data: T | null;
  loading: boolean;
  error: Error | null;
  refetch: () => void;
}

export const useApi = <T>(
  url: string,
  options: UseApiOptions<T> = {}
): UseApiReturn<T> => {
  const [data, setData] = useState<T | null>(options.initialData || null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<Error | null>(null);
  const abortControllerRef = useRef<AbortController | null>(null);

  const fetchData = useCallback(async () => {
    if (abortControllerRef.current) {
      abortControllerRef.current.abort();
    }

    abortControllerRef.current = new AbortController();
    setLoading(true);
    setError(null);

    try {
      const response = await fetch(url, {
        signal: abortControllerRef.current.signal,
      });

      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }

      const result = await response.json();
      setData(result);
      options.onSuccess?.(result);
    } catch (err) {
      if (err instanceof Error && err.name !== 'AbortError') {
        setError(err);
        options.onError?.(err);
      }
    } finally {
      setLoading(false);
    }
  }, [url, options]);

  useEffect(() => {
    fetchData();

    return () => {
      if (abortControllerRef.current) {
        abortControllerRef.current.abort();
      }
    };
  }, [fetchData]);

  return { data, loading, error, refetch: fetchData };
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö—É–∫–∞
const UserProfile: React.FC<{ userId: string }> = ({ userId }) => {
  const { data: user, loading, error, refetch } = useApi<User>(
    `/api/users/${userId}`,
    {
      onSuccess: (user) => {
        console.log('User loaded:', user);
      },
      onError: (error) => {
        console.error('Failed to load user:', error);
      }
    }
  );

  if (loading) {
    return (
      <div className="flex items-center justify-center p-8">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      </div>
    );
  }

  if (error) {
    return (
      <div className="p-4 bg-red-50 border border-red-200 rounded-lg">
        <p className="text-red-600 mb-2">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</p>
        <button
          onClick={refetch}
          className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
        >
          –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
        </button>
      </div>
    );
  }

  if (!user) {
    return <div className="p-4 text-gray-500">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω</div>;
  }

  return (
    <div className="p-6 bg-white rounded-lg shadow-md">
      <h2 className="text-xl font-bold mb-4">{user.name}</h2>
      <p className="text-gray-600">{user.email}</p>
    </div>
  );
};
```

### ‚úÖ Compound Components Pattern
```tsx
import React, { createContext, useContext, useState } from 'react';

interface TabsContextType {
  activeTab: string;
  setActiveTab: (tab: string) => void;
}

const TabsContext = createContext<TabsContextType | null>(null);

const useTabs = () => {
  const context = useContext(TabsContext);
  if (!context) {
    throw new Error('useTabs must be used within Tabs');
  }
  return context;
};

interface TabsProps {
  children: React.ReactNode;
  defaultTab?: string;
}

const Tabs: React.FC<TabsProps> = ({ children, defaultTab = '' }) => {
  const [activeTab, setActiveTab] = useState(defaultTab);

  return (
    <TabsContext.Provider value={{ activeTab, setActiveTab }}>
      <div className="tabs">
        {children}
      </div>
    </TabsContext.Provider>
  );
};

const TabsList: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  return (
    <div className="flex border-b border-gray-200">
      {children}
    </div>
  );
};

interface TabsTriggerProps {
  value: string;
  children: React.ReactNode;
}

const TabsTrigger: React.FC<TabsTriggerProps> = ({ value, children }) => {
  const { activeTab, setActiveTab } = useTabs();

  return (
    <button
      onClick={() => setActiveTab(value)}
      className={`px-4 py-2 font-medium text-sm border-b-2 transition-colors ${
        activeTab === value
          ? 'border-blue-500 text-blue-600'
          : 'border-transparent text-gray-500 hover:text-gray-700'
      }`}
    >
      {children}
    </button>
  );
};

interface TabsContentProps {
  value: string;
  children: React.ReactNode;
}

const TabsContent: React.FC<TabsContentProps> = ({ value, children }) => {
  const { activeTab } = useTabs();

  if (activeTab !== value) {
    return null;
  }

  return (
    <div className="p-4">
      {children}
    </div>
  );
};

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
const MyTabs: React.FC = () => {
  return (
    <Tabs defaultTab="tab1">
      <TabsList>
        <TabsTrigger value="tab1">–í–∫–ª–∞–¥–∫–∞ 1</TabsTrigger>
        <TabsTrigger value="tab2">–í–∫–ª–∞–¥–∫–∞ 2</TabsTrigger>
        <TabsTrigger value="tab3">–í–∫–ª–∞–¥–∫–∞ 3</TabsTrigger>
      </TabsList>
      
      <TabsContent value="tab1">
        <h3>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ 1</h3>
        <p>–≠—Ç–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–µ—Ä–≤–æ–π –≤–∫–ª–∞–¥–∫–∏.</p>
      </TabsContent>
      
      <TabsContent value="tab2">
        <h3>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ 2</h3>
        <p>–≠—Ç–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤—Ç–æ—Ä–æ–π –≤–∫–ª–∞–¥–∫–∏.</p>
      </TabsContent>
      
      <TabsContent value="tab3">
        <h3>–°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤–∫–ª–∞–¥–∫–∏ 3</h3>
        <p>–≠—Ç–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç—Ä–µ—Ç—å–µ–π –≤–∫–ª–∞–¥–∫–∏.</p>
      </TabsContent>
    </Tabs>
  );
};

export { Tabs, TabsList, TabsTrigger, TabsContent };
```

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û

### ‚ùå –ù–ï –î–ï–õ–ê–ô–¢–ï
```tsx
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –∫–ª–∞—Å—Å–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
class MyComponent extends React.Component {
  render() {
    return <div>Hello</div>;
  }
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ —Ö—É–∫–∏
const BadComponent = () => {
  const [state, setState] = useState();
  // –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
};

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
const BadSearch = () => {
  const [query, setQuery] = useState('');
  const [results, setResults] = useState([]);
  
  const handleSearch = (value) => {
    setQuery(value); // –ë–ª–æ–∫–∏—Ä—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    // –¢—è–∂–µ–ª—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
  };
};
```

### ‚úÖ –î–ï–õ–ê–ô–¢–ï –¢–ê–ö
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
const MyComponent: React.FC = () => {
  return <div>Hello</div>;
};

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ö—É–∫–∏
const GoodComponent: React.FC = () => {
  const [state, setState] = useState<string>('');
  // –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
};

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
const GoodSearch: React.FC = () => {
  const [query, setQuery] = useState('');
  const [isPending, startTransition] = useTransition();
  
  const handleSearch = (value: string) => {
    startTransition(() => {
      setQuery(value); // –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
    });
  };
};
```

## üéØ –õ–£–ß–®–ò–ï –ü–†–ê–ö–¢–ò–ö–ò

### 1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ö—É–∫–∏**
```tsx
// useId –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö ID
const id = useId();

// useDeferredValue –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
const deferredValue = useDeferredValue(value);

// useSyncExternalStore –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
const externalData = useSyncExternalStore(subscribe, getSnapshot);
```

### 2. **–ü—Ä–∏–º–µ–Ω—è–π—Ç–µ Suspense –ø—Ä–∞–≤–∏–ª—å–Ω–æ**
```tsx
// –í—Å–µ–≥–¥–∞ –æ–±–æ—Ä–∞—á–∏–≤–∞–π—Ç–µ lazy –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ Suspense
<Suspense fallback={<LoadingSpinner />}>
  <LazyComponent />
</Suspense>
```

### 3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Error Boundaries**
```tsx
// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
<ErrorBoundary>
  <RiskyComponent />
</ErrorBoundary>
```

---

**–ü–æ–º–Ω–∏**: React 18 - —ç—Ç–æ –±—É–¥—É—â–µ–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ UX.