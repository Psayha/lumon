---
globs: front/**/*.tsx,packages/**/*.tsx
description: –ü—Ä–∞–≤–∏–ª–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è Lumon
---

# ‚ö° Performance Optimization Rules

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### ‚úÖ –ü–†–û–§–ò–õ–ò–†–û–í–ê–ù–ò–ï –ü–ï–†–ï–î –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ï–ô
- –ò–∑–º–µ—Ä—è–π—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ React DevTools Profiler
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Ç–æ–ª—å–∫–æ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞
- –ù–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–æ

### ‚úÖ –†–ï–ê–ö–¢–ò–í–ù–´–ï –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò
- `useCallback` –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –≤ –¥–æ—á–µ—Ä–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `useMemo` –¥–ª—è –¥–æ—Ä–æ–≥–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
- `React.memo` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ª–∏—à–Ω–∏—Ö re-renders
- `useMemo` –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ –Ω–∞ –æ–±—ä–µ–∫—Ç—ã

### ‚úÖ –ö–û–ú–ü–û–ù–ï–ù–¢–ù–ê–Ø –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø
- –†–∞–∑–±–∏–≤–∞–π—Ç–µ –±–æ–ª—å—à–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ –º–µ–Ω—å—à–∏–µ
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ lazy loading –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Å–ø–∏—Å–∫–∏ —Å –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–µ–π
- –ò–∑–±–µ–≥–∞–π—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –≤ render

## üìù –ü–†–ò–ú–ï–†–´ –ü–†–ê–í–ò–õ–¨–ù–û–ô –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

### ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
```tsx
import React, { useState, useMemo, useCallback } from 'react';
import { FixedSizeList as List } from 'react-window';

interface User {
  id: string;
  name: string;
  email: string;
}

interface UserListProps {
  users: User[];
  onUserSelect: (user: User) => void;
}

const UserList: React.FC<UserListProps> = ({ users, onUserSelect }) => {
  const [searchTerm, setSearchTerm] = useState('');

  // –ú–µ–º–æ–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  const filteredUsers = useMemo(() => {
    return users.filter(user =>
      user.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      user.email.toLowerCase().includes(searchTerm.toLowerCase())
    );
  }, [users, searchTerm]);

  // –ú–µ–º–æ–∏–∑–∞—Ü–∏—è callback —Ñ—É–Ω–∫—Ü–∏–∏
  const handleUserClick = useCallback((user: User) => {
    onUserSelect(user);
  }, [onUserSelect]);

  // –ú–µ–º–æ–∏–∑–∞—Ü–∏—è render —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
  const Row = useCallback(({ index, style }: { index: number; style: React.CSSProperties }) => {
    const user = filteredUsers[index];
    
    return (
      <div style={style} className="flex items-center p-4 border-b">
        <div className="flex-1">
          <h3 className="font-semibold">{user.name}</h3>
          <p className="text-gray-600">{user.email}</p>
        </div>
        <button
          onClick={() => handleUserClick(user)}
          className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
        >
          –í—ã–±—Ä–∞—Ç—å
        </button>
      </div>
    );
  }, [filteredUsers, handleUserClick]);

  return (
    <div className="h-96">
      <input
        type="text"
        placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π..."
        value={searchTerm}
        onChange={(e) => setSearchTerm(e.target.value)}
        className="w-full p-3 border rounded-lg mb-4"
      />
      
      <List
        height={300}
        itemCount={filteredUsers.length}
        itemSize={80}
        width="100%"
      >
        {Row}
      </List>
    </div>
  );
};

export default React.memo(UserList);
```

### ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞
```tsx
import React, { useState, useCallback, useMemo } from 'react';

interface FormData {
  name: string;
  email: string;
  age: number;
}

interface OptimizedFormProps {
  onSubmit: (data: FormData) => void;
  initialData?: Partial<FormData>;
}

const OptimizedForm: React.FC<OptimizedFormProps> = ({ 
  onSubmit, 
  initialData = {} 
}) => {
  const [formData, setFormData] = useState<FormData>({
    name: '',
    email: '',
    age: 0,
    ...initialData
  });

  // –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
  const validation = useMemo(() => {
    const errors: Record<string, string> = {};
    
    if (!formData.name.trim()) {
      errors.name = '–ò–º—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ';
    }
    
    if (!formData.email.includes('@')) {
      errors.email = '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email';
    }
    
    if (formData.age < 0) {
      errors.age = '–í–æ–∑—Ä–∞—Å—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º';
    }
    
    return {
      errors,
      isValid: Object.keys(errors).length === 0
    };
  }, [formData]);

  // –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
  const handleInputChange = useCallback((field: keyof FormData) => 
    (e: React.ChangeEvent<HTMLInputElement>) => {
      setFormData(prev => ({
        ...prev,
        [field]: e.target.value
      }));
    }, []);

  const handleSubmit = useCallback((e: React.FormEvent) => {
    e.preventDefault();
    if (validation.isValid) {
      onSubmit(formData);
    }
  }, [formData, validation.isValid, onSubmit]);

  return (
    <form onSubmit={handleSubmit} className="space-y-4">
      <div>
        <label className="block text-sm font-medium mb-1">–ò–º—è</label>
        <input
          type="text"
          value={formData.name}
          onChange={handleInputChange('name')}
          className="w-full p-2 border rounded"
        />
        {validation.errors.name && (
          <p className="text-red-500 text-sm">{validation.errors.name}</p>
        )}
      </div>

      <div>
        <label className="block text-sm font-medium mb-1">Email</label>
        <input
          type="email"
          value={formData.email}
          onChange={handleInputChange('email')}
          className="w-full p-2 border rounded"
        />
        {validation.errors.email && (
          <p className="text-red-500 text-sm">{validation.errors.email}</p>
        )}
      </div>

      <div>
        <label className="block text-sm font-medium mb-1">–í–æ–∑—Ä–∞—Å—Ç</label>
        <input
          type="number"
          value={formData.age}
          onChange={handleInputChange('age')}
          className="w-full p-2 border rounded"
        />
        {validation.errors.age && (
          <p className="text-red-500 text-sm">{validation.errors.age}</p>
        )}
      </div>

      <button
        type="submit"
        disabled={!validation.isValid}
        className="w-full py-2 bg-blue-500 text-white rounded disabled:bg-gray-300"
      >
        –û—Ç–ø—Ä–∞–≤–∏—Ç—å
      </button>
    </form>
  );
};

export default React.memo(OptimizedForm);
```

### ‚úÖ Lazy Loading –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```tsx
import React, { Suspense, lazy } from 'react';

// Lazy loading —Ç—è–∂–µ–ª—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
const HeavyChart = lazy(() => import('./HeavyChart'));
const DataTable = lazy(() => import('./DataTable'));
const ReportGenerator = lazy(() => import('./ReportGenerator'));

const Dashboard: React.FC = () => {
  const [activeTab, setActiveTab] = useState('chart');

  const renderTabContent = () => {
    switch (activeTab) {
      case 'chart':
        return (
          <Suspense fallback={<div className="flex items-center justify-center h-64">
            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
          </div>}>
            <HeavyChart />
          </Suspense>
        );
      case 'table':
        return (
          <Suspense fallback={<div className="flex items-center justify-center h-64">
            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
          </div>}>
            <DataTable />
          </Suspense>
        );
      case 'report':
        return (
          <Suspense fallback={<div className="flex items-center justify-center h-64">
            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
          </div>}>
            <ReportGenerator />
          </Suspense>
        );
      default:
        return null;
    }
  };

  return (
    <div className="p-6">
      <div className="flex space-x-4 mb-6">
        {['chart', 'table', 'report'].map(tab => (
          <button
            key={tab}
            onClick={() => setActiveTab(tab)}
            className={`px-4 py-2 rounded ${
              activeTab === tab 
                ? 'bg-blue-500 text-white' 
                : 'bg-gray-200 text-gray-700'
            }`}
          >
            {tab.charAt(0).toUpperCase() + tab.slice(1)}
          </button>
        ))}
      </div>
      
      {renderTabContent()}
    </div>
  );
};

export default Dashboard;
```

### ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
```tsx
import React, { createContext, useContext, useMemo, useCallback } from 'react';

interface User {
  id: string;
  name: string;
  email: string;
}

interface UserContextType {
  user: User | null;
  login: (user: User) => void;
  logout: () => void;
  updateUser: (updates: Partial<User>) => void;
}

const UserContext = createContext<UserContextType | null>(null);

export const UserProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);

  // –ú–µ–º–æ–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  const login = useCallback((userData: User) => {
    setUser(userData);
  }, []);

  const logout = useCallback(() => {
    setUser(null);
  }, []);

  const updateUser = useCallback((updates: Partial<User>) => {
    setUser(prev => prev ? { ...prev, ...updates } : null);
  }, []);

  // –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
  const contextValue = useMemo(() => ({
    user,
    login,
    logout,
    updateUser
  }), [user, login, logout, updateUser]);

  return (
    <UserContext.Provider value={contextValue}>
      {children}
    </UserContext.Provider>
  );
};

export const useUser = () => {
  const context = useContext(UserContext);
  if (!context) {
    throw new Error('useUser must be used within UserProvider');
  }
  return context;
};
```

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û

### ‚ùå –ù–ï –î–ï–õ–ê–ô–¢–ï
```tsx
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - –∏–∑–±—ã—Ç–æ—á–Ω–∞—è –º–µ–º–æ–∏–∑–∞—Ü–∏—è
const OverOptimized = () => {
  const memoizedValue = useMemo(() => count + 1, [count]);
  const memoizedCallback = useCallback(() => {}, []);
  const memoizedObject = useMemo(() => ({ id: 1 }), []);
  // –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–ª—É—á–∞—è
};

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ render
const BadComponent = () => {
  return <ChildComponent style={{ margin: 10 }} />; // –ù–æ–≤—ã–π –æ–±—ä–µ–∫—Ç –∫–∞–∂–¥—ã–π render
};

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - inline —Ñ—É–Ω–∫—Ü–∏–∏
const BadList = ({ items }) => {
  return (
    <div>
      {items.map(item => (
        <Item 
          key={item.id} 
          onClick={() => handleClick(item.id)} // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∫–∞–∂–¥—ã–π render
        />
      ))}
    </div>
  );
};
```

### ‚úÖ –î–ï–õ–ê–ô–¢–ï –¢–ê–ö
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –ø—Ä–æ—Å—Ç–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
const SimpleComponent = () => {
  const [count, setCount] = useState(0);
  return <div>{count}</div>;
};

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –º–µ–º–æ–∏–∑–∞—Ü–∏—è —Å—Ç–∏–ª–µ–π
const GoodComponent = () => {
  const style = useMemo(() => ({ margin: 10 }), []);
  return <ChildComponent style={style} />;
};

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û - –º–µ–º–æ–∏–∑–∞—Ü–∏—è callback
const GoodList = ({ items }) => {
  const handleItemClick = useCallback((id: string) => {
    // –ª–æ–≥–∏–∫–∞
  }, []);

  return (
    <div>
      {items.map(item => (
        <Item 
          key={item.id} 
          onClick={handleItemClick}
        />
      ))}
    </div>
  );
};
```

## üéØ –õ–£–ß–®–ò–ï –ü–†–ê–ö–¢–ò–ö–ò

### 1. **–ò–∑–º–µ—Ä–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
```tsx
// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ React DevTools Profiler
// –ò–∑–º–µ—Ä—è–π—Ç–µ –≤—Ä–µ–º—è —Ä–µ–Ω–¥–µ—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
// –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –ø—Ä–∏—á–∏–Ω—ã re-renders
```

### 2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤**
```tsx
// –î–ª—è –±–æ–ª—å—à–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—é
import { FixedSizeList as List } from 'react-window';

// –î–ª—è —Å—Ä–µ–¥–Ω–∏—Ö —Å–ø–∏—Å–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ React.memo
const ListItem = React.memo(({ item }) => {
  return <div>{item.name}</div>;
});
```

### 3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**
```tsx
// Lazy loading –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const LazyImage = ({ src, alt }) => {
  const [loaded, setLoaded] = useState(false);
  
  return (
    <img
      src={loaded ? src : '/placeholder.jpg'}
      alt={alt}
      onLoad={() => setLoaded(true)}
      className="transition-opacity duration-200"
    />
  );
};
```

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

### React DevTools Profiler
```tsx
// –í–∫–ª—é—á–∏—Ç–µ Profiler –≤ React DevTools
// –ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
// –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –≤—Ä–µ–º—è —Ä–µ–Ω–¥–µ—Ä–∞ –∏ –ø—Ä–∏—á–∏–Ω—ã re-renders
```

### Performance API
```tsx
// –ò–∑–º–µ—Ä–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
const measurePerformance = (name: string, fn: () => void) => {
  performance.mark(`${name}-start`);
  fn();
  performance.mark(`${name}-end`);
  performance.measure(name, `${name}-start`, `${name}-end`);
};
```

---

**–ü–æ–º–Ω–∏**: –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∏–∑–º–µ—Ä–µ–Ω–∏—è. –ü—Ä–µ–∂–¥–µ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è - –∫–æ—Ä–µ–Ω—å –≤—Å–µ—Ö –∑–æ–ª.